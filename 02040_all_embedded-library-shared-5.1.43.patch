Convert all of the static libraries for the embedded libmysqld to build as
shared.

This enables amarok's mysql extension to properly build as a shared object,
without statically including libmysqld or nor forcing libmysqld to be built
with -fPIC.

Thanks to <pageexec@freemail.hu> for the @plt fixes.
Thanks to Diego Elio Petten√≤ <flameeyes@gentoo.org> for all the extensive build
system help with libtool conversions.

Gentoo-Bug: 238487
Gentoo-Bug-URL: https://bugs.gentoo.org/show_bug.cgi?id=238487
MySQL-Bug-URL: http://bugs.mysql.com/bug.php?id=39288
MySQL-Bug: 39288
MySQL-Lists-URL: http://lists.mysql.com/internals/35947
X-Patch-URL: http://bugs.gentoo.org/attachment.cgi?id=188019&action=view
Signed-off-by: Jorge Manuel B. S. Vicetto <jmbsvicetto@gentoo.org>
Signed-off-by: Robin H. Johnson <robbat2@gentoo.org>

diff -ur mysql/client/Makefile.am mysql-new//client/Makefile.am
--- mysql/client/Makefile.am	2010-01-15 16:14:27.000000000 -0100
+++ mysql-new//client/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -75,7 +75,7 @@
 mysqlimport_LDADD =		$(CXXLDFLAGS) $(CLIENT_THREAD_LIBS) \
 				@CLIENT_EXTRA_LDFLAGS@ \
 				$(LIBMYSQLCLIENT_LA) \
-				$(top_builddir)/mysys/libmysys.a
+				$(top_builddir)/mysys/libmysys.la
 
 mysqlshow_SOURCES=		mysqlshow.c
 
@@ -84,15 +84,15 @@
 mysqlslap_LDADD =		$(CXXLDFLAGS) $(CLIENT_THREAD_LIBS) \
 				@CLIENT_EXTRA_LDFLAGS@ \
 				$(LIBMYSQLCLIENT_LA) \
-				$(top_builddir)/mysys/libmysys.a
+				$(top_builddir)/mysys/libmysys.la
 
 mysqltest_SOURCES=		mysqltest.cc
 mysqltest_CXXFLAGS=		-DTHREAD -UMYSQL_CLIENT_NO_THREADS
 mysqltest_LDADD =		$(CXXLDFLAGS) $(CLIENT_THREAD_LIBS) \
 				@CLIENT_EXTRA_LDFLAGS@ \
 				$(LIBMYSQLCLIENT_LA) \
-				$(top_builddir)/mysys/libmysys.a \
-				$(top_builddir)/regex/libregex.a \
+				$(top_builddir)/mysys/libmysys.la \
+				$(top_builddir)/regex/libregex.la \
 				$(CLIENT_THREAD_LIBS)
 
 mysql_upgrade_SOURCES=          mysql_upgrade.c \
diff -ur mysql/configure.in mysql-new//configure.in
--- mysql/configure.in	2010-01-15 16:14:34.000000000 -0100
+++ mysql-new//configure.in	2010-03-12 01:46:13.000000000 -0100
@@ -2778,7 +2778,7 @@
 
 dnl This probably should be cleaned up more - for now the threaded
 dnl client is just using plain-old libs.
-sql_client_dirs="strings mysys dbug extra regex libmysql"
+sql_client_dirs="strings regex dbug mysys extra libmysql"
 
 AM_CONDITIONAL(THREAD_SAFE_CLIENT, test "$THREAD_SAFE_CLIENT" != "no")
 
@@ -2806,20 +2806,18 @@
 AC_SUBST(netware_dir)
 AM_CONDITIONAL(HAVE_NETWARE, test "$netware_dir" = "netware")
 
+AM_CONDITIONAL([NEED_THREADS], [test x"$with_server" != xno -o x"$THREAD_SAFE_CLIENT" != xno])
 if test "$with_server" != "no" -o "$THREAD_SAFE_CLIENT" != "no"
 then
   AC_DEFINE([THREAD], [1],
             [Define if you want to have threaded code. This may be undef on client code])
-  # Avoid _PROGRAMS names
-  THREAD_LOBJECTS="thr_alarm.o thr_lock.o thr_mutex.o thr_rwlock.o my_pthread.o my_thr_init.o mf_keycache.o"
-  AC_SUBST(THREAD_LOBJECTS)
 fi
 AM_CONDITIONAL(NEED_THREAD, test "$with_server" != "no" -o "$THREAD_SAFE_CLIENT" != "no")
 
 if test "$with_server" != "no"
 then
   server_scripts="mysqld_safe mysql_install_db"
-  sql_server_dirs="strings mysys dbug extra regex storage plugin"
+  sql_server_dirs="strings dbug mysys extra regex storage plugin"
 
   sql_server="vio sql"
 fi
diff -ur mysql/dbug/Makefile.am mysql-new//dbug/Makefile.am
--- mysql/dbug/Makefile.am	2010-01-15 16:14:34.000000000 -0100
+++ mysql-new//dbug/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -16,10 +16,10 @@
 # MA 02111-1307, USA
 
 INCLUDES =              -I$(top_builddir)/include -I$(top_srcdir)/include
-LDADD =                 libdbug.a ../mysys/libmysys.a ../strings/libmystrings.a
-pkglib_LIBRARIES =      libdbug.a
+LDADD =                 ../mysys/libmysys.la ../strings/libmystrings.la
+noinst_LTLIBRARIES =    libdbug.la
 noinst_HEADERS =        dbug_long.h
-libdbug_a_SOURCES =     dbug.c sanity.c
+libdbug_la_SOURCES =     dbug.c sanity.c
 EXTRA_DIST =            CMakeLists.txt example1.c example2.c example3.c \
                         user.r monty.doc dbug_add_tags.pl \
                         my_main.c main.c factorial.c dbug_analyze.c \
@@ -31,11 +31,11 @@
 
 
 # Must be linked with libs that are not compiled yet
-noinst_PROGRAMS =       factorial dbug_analyze
+EXTRA_PROGRAMS =        factorial dbug_analyze
 factorial_SOURCES =     my_main.c factorial.c
 dbug_analyze_SOURCES =  dbug_analyze.c
 
-all:            user.t user.ps
+check-local:            user.t user.ps
 
 user.t:         user.r $(NROFF_INC)
 		-nroff -mm user.r > $@
diff -ur mysql/extra/Makefile.am mysql-new//extra/Makefile.am
--- mysql/extra/Makefile.am	2010-01-15 16:14:35.000000000 -0100
+++ mysql-new//extra/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -15,8 +15,8 @@
 
 INCLUDES =		-I$(top_builddir)/include -I$(top_srcdir)/include \
 			-I$(top_srcdir)/sql
-LDADD =			@CLIENT_EXTRA_LDFLAGS@ ../mysys/libmysys.a \
-			../dbug/libdbug.a ../strings/libmystrings.a \
+LDADD =			@CLIENT_EXTRA_LDFLAGS@ ../mysys/libmysys.la \
+			../dbug/libdbug.la ../strings/libmystrings.la \
 			$(ZLIB_LIBS)
 BUILT_SOURCES=		$(top_builddir)/include/mysqld_error.h \
                         $(top_builddir)/include/sql_state.h \
diff -ur mysql/libmysql/Makefile.am mysql-new//libmysql/Makefile.am
--- mysql/libmysql/Makefile.am	2010-01-15 16:14:42.000000000 -0100
+++ mysql-new//libmysql/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -106,8 +106,8 @@
 	echo "# This file is autogenerated from Makefile.am" >> $$dir/Makefile; \
 	echo 'CFLAGS=	-I. -DMYSQL_CLIENT_NO_THREADS' >>$$dir/Makefile; \
 	echo "obj=$$objs"  >>$$dir/Makefile; \
-	echo 'all: libmysql.a'  >>$$dir/Makefile; \
-	echo 'libmysql.a: $$(obj)'  >>$$dir/Makefile; \
+	echo 'all: libmysql.la'  >>$$dir/Makefile; \
+	echo 'libmysql.la: $$(obj)'  >>$$dir/Makefile; \
 	echo '	$$(AR) r $$@ $$?'  >>$$dir/Makefile; \
 	gtar cvzf $$dir.tar.gz $$dir; \
 	cd $$dir; gmake
diff -ur mysql/libmysqld/examples/Makefile.am mysql-new//libmysqld/examples/Makefile.am
--- mysql/libmysqld/examples/Makefile.am	2010-01-15 16:14:43.000000000 -0100
+++ mysql-new//libmysqld/examples/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -37,12 +37,12 @@
 		-I$(top_srcdir) -I$(top_srcdir)/client -I$(top_srcdir)/regex \
 		$(openssl_includes)
 LIBS =		@LIBS@ @WRAPLIBS@ @CLIENT_LIBS@ $(yassl_libs)
-LDADD =		@CLIENT_EXTRA_LDFLAGS@ ../libmysqld.a @LIBDL@ $(CXXLDFLAGS) \
+LDADD =		@CLIENT_EXTRA_LDFLAGS@ ../libmysqld.la @LIBDL@ $(CXXLDFLAGS) \
                 @NDB_SCI_LIBS@
 
 mysqltest_embedded_LINK = $(CXXLINK)
 nodist_mysqltest_embedded_SOURCES =	mysqltest.cc
-mysqltest_embedded_LDADD =	$(LDADD) $(top_builddir)/regex/libregex.a
+mysqltest_embedded_LDADD =	$(LDADD) $(top_builddir)/regex/libregex.la
 
 nodist_mysql_SOURCES = mysql.cc readline.cc completion_hash.cc \
                 my_readline.h sql_string.h completion_hash.h
diff -ur mysql/libmysqld/Makefile.am mysql-new//libmysqld/Makefile.am
--- mysql/libmysqld/Makefile.am	2010-01-15 16:14:43.000000000 -0100
+++ mysql-new//libmysqld/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -36,10 +36,10 @@
 			$(openssl_includes) @ZLIB_INCLUDES@ \
 			@condition_dependent_plugin_includes@
 
-noinst_LIBRARIES =	libmysqld_int.a
-pkglib_LIBRARIES =	libmysqld.a
+noinst_LTLIBRARIES =	libmysqld_int.la
+pkglib_LTLIBRARIES =	libmysqld.la
 SUBDIRS =		. examples
-libmysqld_sources=	libmysqld.c lib_sql.cc emb_qcache.cc
+#libmysqld_sources=	libmysqld.c lib_sql.cc emb_qcache.cc
 libmysqlsources =	errmsg.c get_password.c libmysql.c client.c pack.c \
                         my_time.c
 
@@ -79,11 +79,11 @@
 	rpl_injector.cc my_user.c partition_info.cc \
 	sql_servers.cc event_parse_data.cc
 
-libmysqld_int_a_SOURCES= $(libmysqld_sources)
-nodist_libmysqld_int_a_SOURCES= $(libmysqlsources) $(sqlsources)
-libmysqld_a_SOURCES=
+libmysqld_int_la_SOURCES= $(libmysqld_sources)
+nodist_libmysqld_int_la_SOURCES= $(libmysqlsources) $(sqlsources)
+libmysqld_la_SOURCES=$(libmysqld_sources)
 
-sqlstoragesources =	$(EXTRA_libmysqld_a_SOURCES)
+sqlstoragesources =	$(EXTRA_libmysqld_la_SOURCES)
 storagesources = @condition_dependent_plugin_modules@
 storageobjects = @condition_dependent_plugin_objects@
 storagesourceslinks = @condition_dependent_plugin_links@
@@ -91,15 +91,16 @@
 # automake misses these
 sql_yacc.cc sql_yacc.h: $(top_srcdir)/sql/sql_yacc.yy
 
-# The following libraries should be included in libmysqld.a
-INC_LIB=	$(top_builddir)/regex/libregex.a \
-		$(top_builddir)/mysys/libmysys.a \
-		$(top_builddir)/strings/libmystrings.a \
-		$(top_builddir)/dbug/libdbug.a \
-		$(top_builddir)/vio/libvio.a \
-                @NDB_SCI_LIBS@ \
+# The following libraries should be included in libmysqld.la
+libmysqld_la_LIBADD=	$(top_builddir)/regex/libregex.la \
+		$(top_builddir)/mysys/libmysys.la \
+		$(top_builddir)/strings/libmystrings.la \
+		$(top_builddir)/dbug/libdbug.la \
+		$(top_builddir)/vio/libvio.la \
+		@NDB_SCI_LIBS@ \
 		@mysql_plugin_libs@ \
-		$(yassl_inc_libs)
+		$(yassl_inc_libs) \
+		libmysqld_int.la
 
 if HAVE_YASSL
 yassl_inc_libs=	$(top_builddir)/extra/yassl/src/.libs/libyassl.a \
@@ -139,44 +140,6 @@
 ha_myisammrg.o:ha_myisammrg.cc
 		$(CXXCOMPILE) $(LM_CFLAGS) -c $<
 
-#
-# To make it easy for the end user to use the embedded library we
-# generate a total libmysqld.a from all library files,
-
-# note - InnoDB libraries have circular dependencies, so in INC_LIB
-# few libraries are present two times. Metrowerks linker doesn't like
-# it at all. Traditional ar has no problems with it, but still there's no
-# need to add the same file twice to the library, so 'sort -u' save us
-# some time and spares unnecessary work.
-
-libmysqld.a:	libmysqld_int.a $(INC_LIB) $(libmysqld_a_DEPENDENCIES) $(storageobjects)
-if DARWIN_MWCC
-	mwld -lib -o $@ libmysqld_int.a `echo $(INC_LIB) | sort -u` $(storageobjects)
-else
-		-rm -f libmysqld.a
-		if test "$(host_os)" = "netware" ; \
-		then \
-		  $(libmysqld_a_AR) libmysqld.a $(INC_LIB) libmysqld_int.a $(storageobjects); \
-		else \
-		  current_dir=`pwd`; \
-		  rm -rf tmp; mkdir tmp; \
-		  (for arc in $(INC_LIB) ./libmysqld_int.a; do \
-		    arpath=`echo $$arc|sed 's|[^/]*$$||'|sed 's|\.libs/$$||'`; \
-		    artmp=`echo $$arc|sed 's|^.*/|tmp/lib-|'`; \
-		    for F in `$(AR) t $$arc | grep -v SYMDEF`; do \
-		      if test -e "$$arpath/$$F" ; then echo "$$arpath/$$F"; else \
-		      mkdir $$artmp; cd $$artmp > /dev/null; \
-		      $(AR) x ../../$$arc; \
-		      cd $$current_dir > /dev/null; \
-		      ls $$artmp/* | grep -v SYMDEF; \
-		      continue 2; fi; done; \
-		  done; echo $(libmysqld_a_DEPENDENCIES) ) | sort -u | xargs $(AR) cq libmysqld.a ; \
-		  $(AR) r libmysqld.a $(storageobjects); \
-		  $(RANLIB) libmysqld.a	; \
-		  rm -rf tmp; \
-		fi
-endif
-
 ## XXX: any time the client interface changes, we'll need to bump
 ## the version info for libmysqld; however, it's possible for the
 ## libmysqld interface to change without affecting the standard
diff -ur mysql/mysys/Makefile.am mysql-new//mysys/Makefile.am
--- mysql/mysys/Makefile.am	2010-01-15 16:16:29.000000000 -0100
+++ mysql-new//mysys/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -18,10 +18,9 @@
 MYSQLBASEdir=		$(prefix)
 INCLUDES =		@ZLIB_INCLUDES@ -I$(top_builddir)/include \
 			-I$(top_srcdir)/include -I$(srcdir)
-pkglib_LIBRARIES =	libmysys.a
-LDADD =			libmysys.a $(top_builddir)/strings/libmystrings.a $(top_builddir)/dbug/libdbug.a
+pkglib_LTLIBRARIES =	libmysys.la
 noinst_HEADERS =	mysys_priv.h my_static.h my_handler_errors.h
-libmysys_a_SOURCES =    my_init.c my_getwd.c mf_getdate.c my_mmap.c \
+libmysys_la_SOURCES =    my_init.c my_getwd.c mf_getdate.c my_mmap.c \
 			mf_path.c mf_loadpath.c my_file.c \
 			my_open.c my_create.c my_dup.c my_seek.c my_read.c \
 			my_pread.c my_write.c my_getpagesize.c \
@@ -46,7 +45,7 @@
 			my_quick.c my_lockmem.c my_static.c \
 			my_sync.c my_getopt.c my_mkdir.c \
 			default_modify.c default.c \
-                        my_compress.c checksum.c \
+			my_compress.c checksum.c \
 			my_net.c my_port.c my_sleep.c \
 			charset.c charset-def.c my_bitmap.c my_bit.c md5.c \
 			my_gethostbyname.c rijndael.c my_aes.c sha1.c \
@@ -54,22 +53,23 @@
 			my_memmem.c stacktrace.c \
 			my_windac.c my_access.c base64.c my_libwrap.c
 
+libmysys_la_LIBADD = $(top_builddir)/dbug/libdbug.la $(top_builddir)/strings/libmystrings.la \
+			$(ZLIB_LIBS)
 if NEED_THREAD
 # mf_keycache is used only in the server, so it is safe to leave the file
 # out of the non-threaded library.
 # In fact, it will currently not compile without thread support.
-libmysys_a_SOURCES +=   mf_keycache.c
+libmysys_la_SOURCES +=  thr_alarm.c thr_lock.c thr_mutex.c thr_rwlock.c my_pthread.c my_thr_init.c mf_keycache.c
 endif
 
 EXTRA_DIST =		thr_alarm.c thr_lock.c my_pthread.c my_thr_init.c \
 			thr_mutex.c thr_rwlock.c \
 			CMakeLists.txt mf_soundex.c \
 			my_conio.c my_wincond.c my_winthread.c
-libmysys_a_LIBADD =	@THREAD_LOBJECTS@
-# test_dir_DEPENDENCIES=	$(LIBRARIES)
-# testhash_DEPENDENCIES=	$(LIBRARIES)
-# test_charset_DEPENDENCIES=	$(LIBRARIES)
-# charset2html_DEPENDENCIES=	$(LIBRARIES)
+# test_dir_DEPENDENCIES=	$(LTLIBRARIES)
+# testhash_DEPENDENCIES=	$(LTLIBRARIES)
+# test_charset_DEPENDENCIES=	$(LTLIBRARIES)
+# charset2html_DEPENDENCIES=	$(LTLIBRARIES)
 DEFS =			-DDEFAULT_BASEDIR=\"$(prefix)\" \
 			-DMYSQL_DATADIR="\"$(MYSQLDATAdir)\"" \
 			-DDEFAULT_CHARSET_HOME="\"$(MYSQLBASEdir)\"" \
@@ -79,8 +79,6 @@
 			-DDEFAULT_SYSCONFDIR="\"$(sysconfdir)\"" \
                         @DEFS@
 
-libmysys_a_DEPENDENCIES= @THREAD_LOBJECTS@
-
 # I hope this always does the right thing. Otherwise this is only test programs
 FLAGS=$(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) @NOINST_LDFLAGS@
 
@@ -89,39 +87,39 @@
 # which automaticly removes the object files you use to compile a final program
 #
 
-test_bitmap$(EXEEXT): my_bitmap.c $(LIBRARIES)
+test_bitmap$(EXEEXT): my_bitmap.c $(LTLIBRARIES)
 	$(LINK) $(FLAGS) -DMAIN  ./my_bitmap.c $(LDADD) $(LIBS)
 
-test_priority_queue$(EXEEXT): queues.c $(LIBRARIES)
+test_priority_queue$(EXEEXT): queues.c $(LTLIBRARIES)
 	$(LINK) $(FLAGS) -DMAIN  ./queues.c $(LDADD) $(LIBS)
 
-test_thr_alarm$(EXEEXT): thr_alarm.c $(LIBRARIES)
+test_thr_alarm$(EXEEXT): thr_alarm.c $(LTLIBRARIES)
 	$(CP) $(srcdir)/thr_alarm.c ./test_thr_alarm.c
 	$(LINK) $(FLAGS) -DMAIN  ./test_thr_alarm.c $(LDADD) $(LIBS)
 	$(RM) -f ./test_thr_alarm.c
 
-test_thr_lock$(EXEEXT): thr_lock.c $(LIBRARIES)
+test_thr_lock$(EXEEXT): thr_lock.c $(LTLIBRARIES)
 	$(CP) $(srcdir)/thr_lock.c test_thr_lock.c
 	$(LINK) $(FLAGS) -DMAIN  ./test_thr_lock.c $(LDADD) $(LIBS)
 	$(RM) -f ./test_thr_lock.c
 
-test_vsnprintf$(EXEEXT): my_vsnprintf.c $(LIBRARIES)
+test_vsnprintf$(EXEEXT): my_vsnprintf.c $(LTLIBRARIES)
 	$(CP) $(srcdir)/my_vsnprintf.c test_vsnprintf.c
 	$(LINK) $(FLAGS) -DMAIN ./test_vsnprintf.c $(LDADD) $(LIBS)
 	$(RM) -f test_vsnprintf.c
 
-test_io_cache$(EXEEXT): mf_iocache.c $(LIBRARIES)
+test_io_cache$(EXEEXT): mf_iocache.c $(LTLIBRARIES)
 	$(CP) $(srcdir)/mf_iocache.c test_io_cache.c
 	$(LINK) $(FLAGS) -DMAIN ./test_io_cache.c $(LDADD) $(LIBS)
 	$(RM) -f test_io_cache.c
 
-test_dir$(EXEEXT): test_dir.c $(LIBRARIES)
+test_dir$(EXEEXT): test_dir.c $(LTLIBRARIES)
 	$(LINK) $(FLAGS) -DMAIN $(srcdir)/test_dir.c $(LDADD) $(LIBS)
 
-test_charset$(EXEEXT): test_charset.c $(LIBRARIES)
+test_charset$(EXEEXT): test_charset.c $(LTLIBRARIES)
 	$(LINK) $(FLAGS) -DMAIN $(srcdir)/test_charset.c $(LDADD) $(LIBS)
 
-testhash$(EXEEXT): testhash.c $(LIBRARIES)
+testhash$(EXEEXT): testhash.c $(LTLIBRARIES)
 	$(LINK) $(FLAGS) -DMAIN $(srcdir)/testhash.c $(LDADD) $(LIBS)
 
 test_gethwaddr$(EXEEXT): my_gethwaddr.c $(LIBRARIES)
@@ -129,7 +127,7 @@
 	$(LINK) $(FLAGS) -DMAIN  ./test_gethwaddr.c $(LDADD) $(LIBS)
 	$(RM) -f ./test_gethwaddr.c
 
-test_base64$(EXEEXT): base64.c $(LIBRARIES)
+test_base64$(EXEEXT): base64.c $(LTLIBRARIES)
 	$(CP) $(srcdir)/base64.c ./test_base64.c
 	$(LINK) $(FLAGS) -DMAIN  ./test_base64.c $(LDADD) $(LIBS)
 	$(RM) -f ./test_base64.c
diff -ur mysql/netware/Makefile.am mysql-new//netware/Makefile.am
--- mysql/netware/Makefile.am	2010-01-15 16:16:31.000000000 -0100
+++ mysql-new//netware/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -16,14 +16,13 @@
 
 if HAVE_NETWARE
 INCLUDES =			-I$(top_builddir)/include -I$(top_srcdir)/include -I..
-LDADD =				@CLIENT_EXTRA_LDFLAGS@ ../mysys/libmysys.a \
-				../dbug/libdbug.a ../strings/libmystrings.a
+LDADD =				@CLIENT_EXTRA_LDFLAGS@ ../mysys/libmysys.la
 bin_PROGRAMS =			mysqld_safe mysql_install_db mysql_test_run libmysql
 mysqld_safe_SOURCES=		mysqld_safe.c my_manage.c
 mysql_install_db_SOURCES=	mysql_install_db.c my_manage.c
 mysql_test_run_SOURCES=		mysql_test_run.c my_manage.c
 libmysql_SOURCES=		libmysqlmain.c
-libmysql_LDADD =		../libmysql/.libs/libmysqlclient.a \
+libmysql_LDADD =		../libmysql/.libs/libmysqlclient.la \
 				@openssl_libs@ @yassl_libs@
 
 netware_build_files =           client/mysql.def client/mysqladmin.def \
diff -ur mysql/pstack/Makefile.am mysql-new//pstack/Makefile.am
--- mysql/pstack/Makefile.am	2010-01-15 16:16:32.000000000 -0100
+++ mysql-new//pstack/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -22,8 +22,8 @@
 
 INCLUDES =		-I$(top_builddir)/include -I$(top_srcdir)/include
 
-pkglib_LIBRARIES =	libpstack.a
-libpstack_a_SOURCES =	bucomm.c filemode.c linuxthreads.c rddbg.c \
+pkglib_LTLIBRARIES =	libpstack.la
+libpstack_la_SOURCES =	bucomm.c filemode.c linuxthreads.c rddbg.c \
 			debug.c ieee.c pstack.c stabs.c
 noinst_HEADERS =	bucomm.h debug.h ieee.h budbg.h demangle.h \
 			linuxthreads.h pstack.h pstacktrace.h
diff -ur mysql/regex/Makefile.am mysql-new//regex/Makefile.am
--- mysql/regex/Makefile.am	2010-01-15 16:16:32.000000000 -0100
+++ mysql-new//regex/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -16,10 +16,10 @@
 # MA 02111-1307, USA
 
 INCLUDES =		-I$(top_builddir)/include -I$(top_srcdir)/include
-noinst_LIBRARIES =	libregex.a
-LDADD=			libregex.a $(top_builddir)/strings/libmystrings.a
+pkglib_LTLIBRARIES =	libregex.la
+LDADD=			libregex.la $(top_builddir)/strings/libmystrings.la
 noinst_HEADERS =	cclass.h cname.h regex2.h utils.h engine.c my_regex.h
-libregex_a_SOURCES =	regerror.c regcomp.c regexec.c regfree.c reginit.c
+libregex_la_SOURCES =	regerror.c regcomp.c regexec.c regfree.c reginit.c
 noinst_PROGRAMS =	re
 re_SOURCES =		split.c debug.c main.c
 re_LDFLAGS= @NOINST_LDFLAGS@
diff -ur mysql/server-tools/instance-manager/Makefile.am mysql-new//server-tools/instance-manager/Makefile.am
--- mysql/server-tools/instance-manager/Makefile.am	2010-01-15 16:16:33.000000000 -0100
+++ mysql-new//server-tools/instance-manager/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -23,8 +23,7 @@
 # default_options.h, generated from default_options.h.in)
 # See automake/autoconf docs for details
 
-noinst_LTLIBRARIES= liboptions.la
-noinst_LIBRARIES=   libnet.a
+noinst_LTLIBRARIES= liboptions.la libnet.la
 
 liboptions_la_CXXFLAGS= $(CXXFLAGS) \
 	-DDEFAULT_PID_FILE_NAME="$(localstatedir)/mysqlmanager.pid" \
@@ -36,17 +35,17 @@
 	-DPROTOCOL_VERSION=@PROTOCOL_VERSION@
 
 liboptions_la_SOURCES= options.h options.cc priv.h priv.cc
-liboptions_la_LIBADD= $(top_builddir)/libmysql/get_password.lo
+
+liboptions_la_LIBADD= $(top_builddir)/libmysql/libmysqlclient.la
 
 # MySQL sometimes uses symlinks to reuse code 
 # All symlinked files are grouped in libnet.a
 
-nodist_libnet_a_SOURCES= net_serv.cc client_settings.h
-libnet_a_LIBADD= $(top_builddir)/sql/password.$(OBJEXT) \
-	$(top_builddir)/sql/pack.$(OBJEXT) \
-	$(top_builddir)/sql/sql_state.$(OBJEXT) \
-	$(top_builddir)/sql/mini_client_errors.$(OBJEXT)\
-	$(top_builddir)/sql/client.$(OBJEXT)
+nodist_libnet_la_SOURCES= net_serv.cc client_settings.h \
+	$(srcdir)/../../sql/password.c $(srcdir)/../../sql/pack.c \
+	$(srcdir)/../../sql/sql_state.c $(srcdir)/../../sql/mini_client_errors.c \
+	$(srcdir)/../../sql/client.c
+
 
 CLEANFILES= net_serv.cc client_settings.h
 
@@ -86,11 +85,11 @@
 
 mysqlmanager_LDADD=	@CLIENT_EXTRA_LDFLAGS@ \
 			liboptions.la \
-			libnet.a \
-			$(top_builddir)/vio/libvio.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/strings/libmystrings.a \
-			$(top_builddir)/dbug/libdbug.a \
+			libnet.la \
+			$(top_builddir)/vio/libvio.la \
+			$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/strings/libmystrings.la \
+			$(top_builddir)/dbug/libdbug.la \
 			@openssl_libs@ @yassl_libs@ @ZLIB_LIBS@
 
 EXTRA_DIST =		WindowsService.cpp WindowsService.h IMService.cpp \
diff -ur mysql/sql/Makefile.am mysql-new//sql/Makefile.am
--- mysql/sql/Makefile.am	2010-01-15 16:16:33.000000000 -0100
+++ mysql-new//sql/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -32,11 +32,11 @@
 noinst_LTLIBRARIES=	libndb.la \
 			udf_example.la
 
-SUPPORTING_LIBS =	$(top_builddir)/vio/libvio.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/regex/libregex.a \
-			$(top_builddir)/strings/libmystrings.a
+SUPPORTING_LIBS =	$(top_builddir)/vio/libvio.la \
+			$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/dbug/libdbug.la \
+			$(top_builddir)/regex/libregex.la \
+			$(top_builddir)/strings/libmystrings.la
 mysqld_DEPENDENCIES=	@mysql_plugin_libs@ $(SUPPORTING_LIBS) libndb.la
 LDADD = $(SUPPORTING_LIBS) @ZLIB_LIBS@ @NDB_SCI_LIBS@
 mysqld_LDADD =		libndb.la \
diff -ur mysql/storage/archive/Makefile.am mysql-new//storage/archive/Makefile.am
--- mysql/storage/archive/Makefile.am	2010-01-15 16:17:33.000000000 -0100
+++ mysql-new//storage/archive/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -23,7 +23,7 @@
 INCLUDES =              -I$(top_srcdir)/include -I$(top_builddir)/include \
 			-I$(top_srcdir)/regex \
 			-I$(top_srcdir)/sql \
-                        -I$(srcdir) @ZLIB_INCLUDES@
+			-I$(srcdir) @ZLIB_INCLUDES@
 WRAPLIBS=
 
 LDADD =
@@ -50,17 +50,17 @@
 
 archive_test_SOURCES =	archive_test.c azio.c
 archive_test_CFLAGS =	$(AM_CFLAGS)
-archive_test_LDADD =	$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a \
+archive_test_LDADD =	$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/dbug/libdbug.la \
+			$(top_builddir)/strings/libmystrings.la \
 			@ZLIB_LIBS@
 archive_test_LDFLAGS = @NOINST_LDFLAGS@
 
 archive_reader_SOURCES = archive_reader.c azio.c
 archive_reader_CFLAGS =	$(AM_CFLAGS)
-archive_reader_LDADD =	$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a \
+archive_reader_LDADD =	$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/dbug/libdbug.la \
+			$(top_builddir)/strings/libmystrings.la \
 			@ZLIB_LIBS@
 archive_reader_LDFLAGS = @NOINST_LDFLAGS@
 
diff -ur mysql/storage/blackhole/plug.in mysql-new//storage/blackhole/plug.in
--- mysql/storage/blackhole/plug.in	2010-01-15 16:17:33.000000000 -0100
+++ mysql-new//storage/blackhole/plug.in	2010-03-12 01:46:51.000000000 -0100
@@ -2,5 +2,4 @@
         [Basic Write-only Read-never tables], [max,max-no-ndb])
 MYSQL_PLUGIN_DIRECTORY(blackhole, [storage/blackhole])
 MYSQL_PLUGIN_STATIC(blackhole,  [libblackhole.a])
-MYSQL_PLUGIN_DYNAMIC(blackhole, [ha_blackhole.la])
 
diff -ur mysql/storage/example/plug.in mysql-new//storage/example/plug.in
--- mysql/storage/example/plug.in	2010-01-15 16:17:33.000000000 -0100
+++ mysql-new//storage/example/plug.in	2010-03-12 01:48:15.000000000 -0100
@@ -1,3 +1,3 @@
 MYSQL_STORAGE_ENGINE(example,,  [Example Storage Engine],
         [Example for Storage Engines for developers], [max,max-no-ndb])
-MYSQL_PLUGIN_DYNAMIC(example,   [ha_example.la])
+MYSQL_PLUGIN_DYNAMIC(example,   [ha_example.a])
diff -ur mysql/storage/federated/plug.in mysql-new//storage/federated/plug.in
--- mysql/storage/federated/plug.in	2010-01-15 16:17:33.000000000 -0100
+++ mysql-new//storage/federated/plug.in	2010-03-12 01:50:59.000000000 -0100
@@ -1,5 +1,4 @@
 MYSQL_STORAGE_ENGINE(federated,,[Federated Storage Engine],
         [Connects to tables on remote MySQL servers], [max,max-no-ndb])
 MYSQL_PLUGIN_STATIC(federated,    [libfederated.a])
-MYSQL_PLUGIN_DYNAMIC(federated,   [ha_federated.la])
 MYSQL_PLUGIN_DEPENDS_ON_MYSQL_INTERNALS(federated, [ha_federated.cc])
diff -ur mysql/storage/heap/Makefile.am mysql-new//storage/heap/Makefile.am
--- mysql/storage/heap/Makefile.am	2010-01-15 16:17:33.000000000 -0100
+++ mysql-new//storage/heap/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -26,21 +26,20 @@
 LDADD =
 
 DEFS =                  @DEFS@
-pkglib_LIBRARIES =	libheap.a
+pkglib_LTLIBRARIES =	libheap.la
 noinst_PROGRAMS	=	hp_test1 hp_test2
-noinst_LIBRARIES =	libheap.a
 hp_test1_LDFLAGS = @NOINST_LDFLAGS@
-hp_test1_LDADD =	libheap.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a
+hp_test1_LDADD =	libheap.la \
+			$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/dbug/libdbug.la \
+			$(top_builddir)/strings/libmystrings.la
 hp_test2_LDFLAGS = @NOINST_LDFLAGS@
-hp_test2_LDADD =	libheap.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a
+hp_test2_LDADD =	libheap.la \
+			$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/dbug/libdbug.la \
+			$(top_builddir)/strings/libmystrings.la
 noinst_HEADERS =	heapdef.h ha_heap.h
-libheap_a_SOURCES =	hp_open.c hp_extra.c hp_close.c hp_panic.c hp_info.c \
+libheap_la_SOURCES =	hp_open.c hp_extra.c hp_close.c hp_panic.c hp_info.c \
 			hp_rrnd.c hp_scan.c hp_update.c hp_write.c hp_delete.c \
 			hp_rsame.c hp_create.c hp_rename.c hp_rfirst.c \
 			hp_rnext.c hp_rlast.c hp_rprev.c hp_clear.c \
diff -ur mysql/storage/heap/plug.in mysql-new//storage/heap/plug.in
--- mysql/storage/heap/plug.in	2010-01-15 16:17:33.000000000 -0100
+++ mysql-new//storage/heap/plug.in	2010-03-12 01:46:13.000000000 -0100
@@ -1,7 +1,7 @@
 MYSQL_STORAGE_ENGINE(heap,no,   [Memory Storage Engine],
         [Volatile memory based tables])
 MYSQL_PLUGIN_DIRECTORY(heap,    [storage/heap])
-MYSQL_PLUGIN_STATIC(heap,       [libheap.a])
+MYSQL_PLUGIN_STATIC(heap,       [libheap.la])
 MYSQL_PLUGIN_MANDATORY(heap)    dnl Memory tables
 MYSQL_PLUGIN_DEPENDS_ON_MYSQL_INTERNALS(heap, [ha_heap.cc])
 
diff -ur mysql/storage/innobase/plug.in mysql-new//storage/innobase/plug.in
--- mysql/storage/innobase/plug.in	2010-01-15 16:17:36.000000000 -0100
+++ mysql-new//storage/innobase/plug.in	2010-03-12 01:46:13.000000000 -0100
@@ -2,7 +2,7 @@
         [Transactional Tables using InnoDB], [max,max-no-ndb])
 MYSQL_PLUGIN_DIRECTORY(innobase, [storage/innobase])
 MYSQL_PLUGIN_STATIC(innobase,   [libinnobase.a])
-MYSQL_PLUGIN_DYNAMIC(innobase,  [ha_innodb.la])
+MYSQL_PLUGIN_DYNAMIC(innobase,  [ha_innodb.so])
 MYSQL_PLUGIN_ACTIONS(innobase,  [
   AC_CHECK_LIB(rt, aio_read, [innodb_system_libs="-lrt"])
   AC_SUBST(innodb_system_libs)
diff -ur mysql/storage/myisam/Makefile.am mysql-new//storage/myisam/Makefile.am
--- mysql/storage/myisam/Makefile.am	2010-01-15 16:17:39.000000000 -0100
+++ mysql-new//storage/myisam/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -20,70 +20,37 @@
 INCLUDES =              -I$(top_srcdir)/include -I$(top_builddir)/include \
 			-I$(top_srcdir)/regex \
 			-I$(top_srcdir)/sql \
-                        -I$(srcdir)
+			-I$(srcdir)
 WRAPLIBS=
 
-LDADD =
+LDADD =					@CLIENT_EXTRA_LDFLAGS@ libmyisam.la \
+			$(top_builddir)/mysys/libmysys.la \
+			$(top_builddir)/dbug/libdbug.la \
+			$(top_builddir)/strings/libmystrings.la @ZLIB_LIBS@
 
 DEFS =                  @DEFS@
 
 EXTRA_DIST =		mi_test_all.sh mi_test_all.res ft_stem.c CMakeLists.txt plug.in
 pkgdata_DATA =		mi_test_all mi_test_all.res
 
-pkglib_LIBRARIES =	libmyisam.a
+noinst_LTLIBRARIES =	libmyisam.la
 bin_PROGRAMS =		myisamchk myisamlog myisampack myisam_ftdump
-myisamchk_DEPENDENCIES=	$(LIBRARIES)
-myisamchk_LDADD=		@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-myisamlog_DEPENDENCIES=	$(LIBRARIES)
-myisamlog_LDADD=		@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-myisampack_DEPENDENCIES=$(LIBRARIES)
-myisampack_LDADD=		@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
+myisamchk_DEPENDENCIES=	$(LTLIBRARIES)
+myisamlog_DEPENDENCIES=	$(LTLIBRARIES)
+myisampack_DEPENDENCIES=$(LTLIBRARIES)
 noinst_PROGRAMS =	mi_test1 mi_test2 mi_test3 rt_test sp_test #ft_test1 ft_eval
 noinst_HEADERS =	myisamdef.h rt_index.h rt_key.h rt_mbr.h sp_defs.h \
 			fulltext.h ftdefs.h ft_test1.h ft_eval.h \
 			ha_myisam.h
-mi_test1_DEPENDENCIES=	$(LIBRARIES)
-mi_test1_LDADD=		@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-mi_test2_DEPENDENCIES=	$(LIBRARIES)
-mi_test2_LDADD=		@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-mi_test3_DEPENDENCIES=	$(LIBRARIES)
-mi_test3_LDADD=		@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-#ft_test1_DEPENDENCIES=	$(LIBRARIES)
-#ft_eval_DEPENDENCIES=	$(LIBRARIES)
-myisam_ftdump_DEPENDENCIES=	$(LIBRARIES)
-myisam_ftdump_LDADD =			@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-rt_test_DEPENDENCIES=	$(LIBRARIES)
-rt_test_LDADD =			@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-sp_test_DEPENDENCIES=	$(LIBRARIES)
-sp_test_LDADD =			@CLIENT_EXTRA_LDFLAGS@ libmyisam.a \
-			$(top_builddir)/mysys/libmysys.a \
-			$(top_builddir)/dbug/libdbug.a \
-			$(top_builddir)/strings/libmystrings.a @ZLIB_LIBS@
-libmyisam_a_SOURCES =	mi_open.c mi_extra.c mi_info.c mi_rkey.c \
+mi_test1_DEPENDENCIES=	$(LTLIBRARIES)
+mi_test2_DEPENDENCIES=	$(LTLIBRARIES)
+mi_test3_DEPENDENCIES=	$(LTLIBRARIES)
+#ft_test1_DEPENDENCIES=	$(LTLIBRARIES)
+#ft_eval_DEPENDENCIES=	$(LTLIBRARIES)
+myisam_ftdump_DEPENDENCIES=	$(LTLIBRARIES)
+rt_test_DEPENDENCIES=	$(LTLIBRARIES)
+sp_test_DEPENDENCIES=	$(LTLIBRARIES)
+libmyisam_la_SOURCES =	mi_open.c mi_extra.c mi_info.c mi_rkey.c \
 			mi_rnext.c mi_rnext_same.c \
 			mi_search.c mi_page.c mi_key.c mi_locking.c \
 			mi_rrnd.c mi_scan.c mi_cache.c \
diff -ur mysql/storage/myisam/plug.in mysql-new//storage/myisam/plug.in
--- mysql/storage/myisam/plug.in	2010-01-15 16:17:40.000000000 -0100
+++ mysql-new//storage/myisam/plug.in	2010-03-12 01:46:13.000000000 -0100
@@ -1,7 +1,6 @@
 MYSQL_STORAGE_ENGINE(myisam,no, [MyISAM Storage Engine],
         [Traditional non-transactional MySQL tables])
 MYSQL_PLUGIN_DIRECTORY(myisam,  [storage/myisam])
-MYSQL_PLUGIN_STATIC(myisam,     [libmyisam.a])
+MYSQL_PLUGIN_STATIC(myisam,     [libmyisam.la])
 MYSQL_PLUGIN_MANDATORY(myisam)  dnl Default
 MYSQL_PLUGIN_DEPENDS_ON_MYSQL_INTERNALS(myisam, [ha_myisam.cc])
-
diff -ur mysql/storage/myisammrg/Makefile.am mysql-new//storage/myisammrg/Makefile.am
--- mysql/storage/myisammrg/Makefile.am	2010-01-15 16:17:40.000000000 -0100
+++ mysql-new//storage/myisammrg/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -20,16 +20,15 @@
 INCLUDES =              -I$(top_srcdir)/include -I$(top_builddir)/include \
 			-I$(top_srcdir)/regex \
 			-I$(top_srcdir)/sql \
-                        -I$(srcdir)
+			-I$(srcdir)
 WRAPLIBS=
 
 LDADD =
 
 DEFS =                  @DEFS@
-pkglib_LIBRARIES =	libmyisammrg.a
+noinst_LTLIBRARIES =	libmyisammrg.la
 noinst_HEADERS =	myrg_def.h ha_myisammrg.h
-noinst_LIBRARIES =	libmyisammrg.a
-libmyisammrg_a_SOURCES = myrg_open.c myrg_extra.c myrg_info.c myrg_locking.c \
+libmyisammrg_la_SOURCES = myrg_open.c myrg_extra.c myrg_info.c myrg_locking.c \
 			myrg_rrnd.c myrg_update.c myrg_delete.c myrg_rsame.c \
 			myrg_panic.c myrg_close.c myrg_create.c myrg_static.c \
 			myrg_rkey.c myrg_rfirst.c myrg_rlast.c myrg_rnext.c \
diff -ur mysql/storage/myisammrg/plug.in mysql-new//storage/myisammrg/plug.in
--- mysql/storage/myisammrg/plug.in	2010-01-15 16:17:41.000000000 -0100
+++ mysql-new//storage/myisammrg/plug.in	2010-03-12 01:46:13.000000000 -0100
@@ -1,6 +1,6 @@
 MYSQL_STORAGE_ENGINE(myisammrg,no,[MyISAM MERGE Engine],
         [Merge multiple MySQL tables into one])
 MYSQL_PLUGIN_DIRECTORY(myisammrg,[storage/myisammrg])
-MYSQL_PLUGIN_STATIC(myisammrg,  [libmyisammrg.a])
+MYSQL_PLUGIN_STATIC(myisammrg,  [libmyisammrg.la])
 MYSQL_PLUGIN_MANDATORY(myisammrg)
 MYSQL_PLUGIN_DEPENDS_ON_MYSQL_INTERNALS(myisammrg, [ha_myisammrg.cc])
diff -ur mysql/storage/ndb/config/type_ndbapitest.mk.am mysql-new//storage/ndb/config/type_ndbapitest.mk.am
--- mysql/storage/ndb/config/type_ndbapitest.mk.am	2010-01-15 16:17:41.000000000 -0100
+++ mysql-new//storage/ndb/config/type_ndbapitest.mk.am	2010-03-12 01:46:13.000000000 -0100
@@ -15,9 +15,9 @@
 
 LDADD += $(top_builddir)/storage/ndb/test/src/libNDBT.a \
          $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a @NDB_SCI_LIBS@
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la @NDB_SCI_LIBS@
 
 INCLUDES += -I$(top_srcdir) \
 	-I$(top_builddir)/include \
diff -ur mysql/storage/ndb/config/type_ndbapitools.mk.am mysql-new//storage/ndb/config/type_ndbapitools.mk.am
--- mysql/storage/ndb/config/type_ndbapitools.mk.am	2010-01-15 16:17:41.000000000 -0100
+++ mysql-new//storage/ndb/config/type_ndbapitools.mk.am	2010-03-12 01:46:13.000000000 -0100
@@ -15,9 +15,9 @@
 
 LDADD += \
          $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a @NDB_SCI_LIBS@ @ZLIB_LIBS@
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la @NDB_SCI_LIBS@ @ZLIB_LIBS@
 
 INCLUDES += -I$(srcdir) \
 	-I$(top_builddir)/include \
diff -ur mysql/storage/ndb/config/win-libraries mysql-new//storage/ndb/config/win-libraries
--- mysql/storage/ndb/config/win-libraries	2010-01-15 16:17:41.000000000 -0100
+++ mysql-new//storage/ndb/config/win-libraries	2010-03-12 01:46:13.000000000 -0100
@@ -21,7 +21,7 @@
 # the same goes for mysys and strings
   lib=$i
   case $i in
-  *libdbug.a | *libmysys.a | *libmystrings.a) 
+  *libdbug.la | *libmysys.la | *libmystrings.la) 
   lib=`echo $i | sed s'!dbug\/lib!!' | sed 's!mysys\/lib!!' | sed 's!strings\/libmy!!'`
   echo "Changing from $i to $lib"
   ;;
diff -ur mysql/storage/ndb/src/common/util/Makefile.am mysql-new//storage/ndb/src/common/util/Makefile.am
--- mysql/storage/ndb/src/common/util/Makefile.am	2010-01-15 16:17:45.000000000 -0100
+++ mysql-new//storage/ndb/src/common/util/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -31,9 +31,9 @@
 testBitmask_SOURCES =  testBitmask.cpp
 testBitmask_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 testBitmask.cpp : Bitmask.cpp
 	rm -f testBitmask.cpp
diff -ur mysql/storage/ndb/src/cw/cpcd/Makefile.am mysql-new//storage/ndb/src/cw/cpcd/Makefile.am
--- mysql/storage/ndb/src/cw/cpcd/Makefile.am	2010-01-15 16:17:46.000000000 -0100
+++ mysql-new//storage/ndb/src/cw/cpcd/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -19,9 +19,9 @@
 
 LDADD_LOC = \
             $(top_builddir)/storage/ndb/src/libndbclient.la      \
-            $(top_builddir)/dbug/libdbug.a \
-            $(top_builddir)/mysys/libmysys.a \
-            $(top_builddir)/strings/libmystrings.a @NDB_SCI_LIBS@
+            $(top_builddir)/dbug/libdbug.la \
+            $(top_builddir)/mysys/libmysys.la \
+            $(top_builddir)/strings/libmystrings.la @NDB_SCI_LIBS@
 
 include $(top_srcdir)/storage/ndb/config/common.mk.am
 include $(top_srcdir)/storage/ndb/config/type_util.mk.am
diff -ur mysql/storage/ndb/src/kernel/blocks/backup/Makefile.am mysql-new//storage/ndb/src/kernel/blocks/backup/Makefile.am
--- mysql/storage/ndb/src/kernel/blocks/backup/Makefile.am	2010-01-15 16:17:46.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/blocks/backup/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -17,9 +17,9 @@
 ndb_print_backup_file_SOURCES = read.cpp
 ndb_print_backup_file_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/strings/libmystrings.la
 
 include $(top_srcdir)/storage/ndb/config/common.mk.am
 include $(top_srcdir)/storage/ndb/config/type_kernel.mk.am
diff -ur mysql/storage/ndb/src/kernel/blocks/dbdict/Makefile.am mysql-new//storage/ndb/src/kernel/blocks/dbdict/Makefile.am
--- mysql/storage/ndb/src/kernel/blocks/dbdict/Makefile.am	2010-01-15 16:17:47.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/blocks/dbdict/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -19,17 +19,17 @@
 LDADD +=  \
          $(top_builddir)/storage/ndb/src/common/util/libgeneral.la \
          $(top_builddir)/storage/ndb/src/common/portlib/libportlib.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 ndbtools_PROGRAMS = ndb_print_schema_file
 ndb_print_schema_file_SOURCES = printSchemaFile.cpp
 ndb_print_schema_file_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 # Don't update the files from bitkeeper
 %::SCCS/s.%
diff -ur mysql/storage/ndb/src/kernel/blocks/dbdih/Makefile.am mysql-new//storage/ndb/src/kernel/blocks/dbdih/Makefile.am
--- mysql/storage/ndb/src/kernel/blocks/dbdih/Makefile.am	2010-01-15 16:17:47.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/blocks/dbdih/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -17,9 +17,9 @@
 ndb_print_sys_file_SOURCES = printSysfile.cpp
 ndb_print_sys_file_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 
 include $(top_srcdir)/storage/ndb/config/common.mk.am
diff -ur mysql/storage/ndb/src/kernel/blocks/dblqh/Makefile.am mysql-new//storage/ndb/src/kernel/blocks/dblqh/Makefile.am
--- mysql/storage/ndb/src/kernel/blocks/dblqh/Makefile.am	2010-01-15 16:17:47.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/blocks/dblqh/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -23,9 +23,9 @@
 
 ndbd_redo_log_reader_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 # Don't update the files from bitkeeper
 %::SCCS/s.%
diff -ur mysql/storage/ndb/src/kernel/blocks/dbtup/Makefile.am mysql-new//storage/ndb/src/kernel/blocks/dbtup/Makefile.am
--- mysql/storage/ndb/src/kernel/blocks/dbtup/Makefile.am	2010-01-15 16:17:48.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/blocks/dbtup/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -20,9 +20,9 @@
 test_varpage_SOURCES = test_varpage.cpp tuppage.cpp
 test_varpage_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-  $(top_builddir)/mysys/libmysys.a \
-  $(top_builddir)/dbug/libdbug.a \
-  $(top_builddir)/strings/libmystrings.a
+  $(top_builddir)/mysys/libmysys.la \
+  $(top_builddir)/dbug/libdbug.la \
+  $(top_builddir)/strings/libmystrings.la
 
 # Don't update the files from bitkeeper
 %::SCCS/s.%
diff -ur mysql/storage/ndb/src/kernel/blocks/Makefile.am mysql-new//storage/ndb/src/kernel/blocks/Makefile.am
--- mysql/storage/ndb/src/kernel/blocks/Makefile.am	2010-01-15 16:17:46.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/blocks/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -57,9 +57,9 @@
 ndb_print_file_SOURCES = print_file.cpp diskpage.cpp dbtup/tuppage.cpp
 ndb_print_file_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 include $(top_srcdir)/storage/ndb/config/common.mk.am
 include $(top_srcdir)/storage/ndb/config/type_kernel.mk.am
diff -ur mysql/storage/ndb/src/kernel/Makefile.am mysql-new//storage/ndb/src/kernel/Makefile.am
--- mysql/storage/ndb/src/kernel/Makefile.am	2010-01-15 16:17:46.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -53,9 +53,9 @@
               $(top_builddir)/storage/ndb/src/mgmapi/libmgmapi.la \
               $(top_builddir)/storage/ndb/src/common/portlib/libportlib.la      \
               $(top_builddir)/storage/ndb/src/common/util/libgeneral.la  \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a @NDB_SCI_LIBS@
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la @NDB_SCI_LIBS@
 
 windoze-dsp: ndbd.dsp
 
diff -ur mysql/storage/ndb/src/kernel/vm/Makefile.am mysql-new//storage/ndb/src/kernel/vm/Makefile.am
--- mysql/storage/ndb/src/kernel/vm/Makefile.am	2010-01-15 16:17:49.000000000 -0100
+++ mysql-new//storage/ndb/src/kernel/vm/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -65,24 +65,24 @@
 ndbd_malloc_impl_test_SOURCES = ndbd_malloc_impl.cpp
 ndbd_malloc_impl_test_LDFLAGS = @ndb_bin_am_ldflags@ \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-  $(top_builddir)/mysys/libmysys.a \
-  $(top_builddir)/dbug/libdbug.a \
-  $(top_builddir)/strings/libmystrings.a
+  $(top_builddir)/mysys/libmysys.la \
+  $(top_builddir)/dbug/libdbug.la \
+  $(top_builddir)/strings/libmystrings.la
 
 bench_pool_SOURCES = bench_pool.cpp
 bench_pool_LDFLAGS = @ndb_bin_am_ldflags@\
   libkernel.a ../error/liberror.a \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-  $(top_builddir)/mysys/libmysys.a \
-  $(top_builddir)/dbug/libdbug.a \
-  $(top_builddir)/strings/libmystrings.a
+  $(top_builddir)/mysys/libmysys.la \
+  $(top_builddir)/dbug/libdbug.la \
+  $(top_builddir)/strings/libmystrings.la
 
 testDynArr256_CXXFLAGS = -DUNIT_TEST
 testDynArr256_SOURCES = DynArr256.cpp
 testDynArr256_LDFLAGS = @ndb_bin_am_ldflags@ \
   libkernel.a ../error/liberror.a \
   $(top_builddir)/storage/ndb/src/libndbclient.la \
-  $(top_builddir)/mysys/libmysys.a \
-  $(top_builddir)/dbug/libdbug.a \
-  $(top_builddir)/strings/libmystrings.a
+  $(top_builddir)/mysys/libmysys.la \
+  $(top_builddir)/dbug/libdbug.la \
+  $(top_builddir)/strings/libmystrings.la
 
diff -ur mysql/storage/ndb/src/mgmclient/Makefile.am mysql-new//storage/ndb/src/mgmclient/Makefile.am
--- mysql/storage/ndb/src/mgmclient/Makefile.am	2010-01-15 16:17:49.000000000 -0100
+++ mysql-new//storage/ndb/src/mgmclient/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -37,9 +37,9 @@
 	    ../common/portlib/libportlib.la \
             @readline_link@ \
             $(top_builddir)/storage/ndb/src/libndbclient.la \
-            $(top_builddir)/dbug/libdbug.a \
-            $(top_builddir)/mysys/libmysys.a \
-            $(top_builddir)/strings/libmystrings.a \
+            $(top_builddir)/dbug/libdbug.la \
+            $(top_builddir)/mysys/libmysys.la \
+            $(top_builddir)/strings/libmystrings.la \
             @TERMCAP_LIB@ @NDB_SCI_LIBS@
 
 ndb_mgm_LDFLAGS = @ndb_bin_am_ldflags@
diff -ur mysql/storage/ndb/src/mgmsrv/Makefile.am mysql-new//storage/ndb/src/mgmsrv/Makefile.am
--- mysql/storage/ndb/src/mgmsrv/Makefile.am	2010-01-15 16:17:50.000000000 -0100
+++ mysql-new//storage/ndb/src/mgmsrv/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -40,9 +40,9 @@
 
 LDADD_LOC = $(top_builddir)/storage/ndb/src/mgmclient/CommandInterpreter.lo \
             $(top_builddir)/storage/ndb/src/libndbclient.la \
-            $(top_builddir)/dbug/libdbug.a \
-            $(top_builddir)/mysys/libmysys.a \
-            $(top_builddir)/strings/libmystrings.a \
+            $(top_builddir)/dbug/libdbug.la \
+            $(top_builddir)/mysys/libmysys.la \
+            $(top_builddir)/strings/libmystrings.la \
             @readline_link@ \
             @NDB_SCI_LIBS@ \
 	    @TERMCAP_LIB@
diff -ur mysql/storage/ndb/src/ndbapi/Makefile.am mysql-new//storage/ndb/src/ndbapi/Makefile.am
--- mysql/storage/ndb/src/ndbapi/Makefile.am	2010-01-15 16:17:50.000000000 -0100
+++ mysql-new//storage/ndb/src/ndbapi/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -67,9 +67,9 @@
 include $(top_srcdir)/storage/ndb/config/type_ndbapi.mk.am
 
 ndberror_check_LDFLAGS = \
-         $(top_builddir)/dbug/libdbug.a \
-         $(top_builddir)/mysys/libmysys.a \
-         $(top_builddir)/strings/libmystrings.a
+         $(top_builddir)/dbug/libdbug.la \
+         $(top_builddir)/mysys/libmysys.la \
+         $(top_builddir)/strings/libmystrings.la
 
 # Don't update the files from bitkeeper
 %::SCCS/s.%
diff -ur mysql/storage/ndb/test/run-test/Makefile.am mysql-new//storage/ndb/test/run-test/Makefile.am
--- mysql/storage/ndb/test/run-test/Makefile.am	2010-01-15 16:17:53.000000000 -0100
+++ mysql-new//storage/ndb/test/run-test/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -34,9 +34,9 @@
 INCLUDES_LOC = -I$(top_srcdir)/storage/ndb/test/include
 LDADD_LOC = $(top_builddir)/storage/ndb/test/src/libNDBT.a \
 	    $(top_builddir)/storage/ndb/src/libndbclient.la \
-            $(top_builddir)/dbug/libdbug.a \
-            $(top_builddir)/mysys/libmysys.a \
-            $(top_builddir)/strings/libmystrings.a @NDB_SCI_LIBS@
+            $(top_builddir)/dbug/libdbug.la \
+            $(top_builddir)/mysys/libmysys.la \
+            $(top_builddir)/strings/libmystrings.la @NDB_SCI_LIBS@
 
 atrt_CXXFLAGS = -I$(top_srcdir)/ndb/src/mgmapi \
                       -I$(top_srcdir)/ndb/src/mgmsrv \
diff -ur mysql/strings/Makefile.am mysql-new//strings/Makefile.am
--- mysql/strings/Makefile.am	2010-01-15 16:17:54.000000000 -0100
+++ mysql-new//strings/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -16,7 +16,7 @@
 # This file is public domain and comes with NO WARRANTY of any kind
 
 INCLUDES =		-I$(top_builddir)/include -I$(top_srcdir)/include
-pkglib_LIBRARIES =	libmystrings.a
+pkglib_LTLIBRARIES =	libmystrings.la
 
 # Exact one of ASSEMBLER_X
 if ASSEMBLER_x86
@@ -37,7 +37,7 @@
 endif
 endif
 
-libmystrings_a_SOURCES = $(ASRCS) $(CSRCS)
+libmystrings_la_SOURCES = $(ASRCS) $(CSRCS)
 noinst_PROGRAMS = conf_to_src
 CLEANFILES = str_test uctypedump test_decimal
 # Default charset definitions
@@ -56,28 +56,27 @@
 			t_ctype.h my_strchr.c CMakeLists.txt \
 			CHARSET_INFO.txt
 
-libmystrings_a_LIBADD=
-conf_to_src_SOURCES = conf_to_src.c xml.c ctype.c bcmp.c
-conf_to_src_LDADD=
+libmystrings_la_LIBADD=
+conf_to_src_SOURCES = conf_to_src.c
+conf_to_src_LDADD = libmystrings.la
 #force static linking of conf_to_src - essential when linking against
 #custom installation of libc
-conf_to_src_LDFLAGS= @NOINST_LDFLAGS@
 
 # This is because the dependency tracking misses @FOO@ vars in sources.
 #strtoull.o:		@CHARSET_OBJS@
 
 
-FLAGS=$(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS) @NOINST_LDFLAGS@
+FLAGS=$(DEFS) $(INCLUDES) $(CPPFLAGS) $(CFLAGS)
 
-str_test: str_test.c $(pkglib_LIBRARIES)
-	$(LINK) $(FLAGS) -DMAIN $(INCLUDES) $(srcdir)/str_test.c $(LDADD) $(pkglib_LIBRARIES)
+str_test: str_test.c $(pkglib_LTLIBRARIES)
+	$(LINK) $(FLAGS) -DMAIN $(INCLUDES) $(srcdir)/str_test.c $(LDADD) $(pkglib_LTLIBRARIES)
 
 uctypedump: uctypedump.c
 	$(LINK) $(INCLUDES) $(srcdir)/uctypedump.c
 
-test_decimal$(EXEEXT): decimal.c $(pkglib_LIBRARIES)
+test_decimal$(EXEEXT): decimal.c $(pkglib_LTLIBRARIES)
 	$(CP) $(srcdir)/decimal.c ./test_decimal.c
-	$(LINK) $(FLAGS) -DMAIN  ./test_decimal.c $(LDADD) $(pkglib_LIBRARIES)
+	$(LINK) $(FLAGS) -DMAIN  ./test_decimal.c $(LDADD) $(pkglib_LTLIBRARIES)
 	$(RM) -f ./test_decimal.c
 
 # Don't update the files from bitkeeper
diff -ur mysql/strings/strings-x86.s mysql-new//strings/strings-x86.s
--- mysql/strings/strings-x86.s	2010-01-15 16:17:55.000000000 -0100
+++ mysql-new//strings/strings-x86.s	2010-03-12 01:46:13.000000000 -0100
@@ -293,7 +293,7 @@
 	movl	%esp,%ebp
 	pushl	12(%ebp)		#  search
 	pushl	8(%ebp)			#  str
-	call	strstr
+	call	strstr@plt
 	add	$8,%esp
 	or	%eax,%eax
 	jz	si_99			#  Not found, return NULL
diff -ur mysql/tests/Makefile.am mysql-new//tests/Makefile.am
--- mysql/tests/Makefile.am	2010-01-15 16:17:55.000000000 -0100
+++ mysql-new//tests/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -49,11 +49,11 @@
 
 insert_test_SOURCES=       insert_test.c
 select_test_SOURCES=       select_test.c
-insert_test_DEPENDENCIES=	$(LIBRARIES) $(pkglib_LTLIBRARIES)
-select_test_DEPENDENCIES=	$(LIBRARIES) $(pkglib_LTLIBRARIES)
+insert_test_DEPENDENCIES=	$(LTLIBRARIES) $(pkglib_LTLIBRARIES)
+select_test_DEPENDENCIES=	$(LTLIBRARIES) $(pkglib_LTLIBRARIES)
 
 bug25714_SOURCES=          bug25714.c
-bug25714_DEPENDENCIES=     $(LIBRARIES) $(pkglib_LTLIBRARIES)
+bug25714_DEPENDENCIES=     $(LTLIBRARIES) $(pkglib_LTLIBRARIES)
 
 # Fix for mit-threads
 DEFS =			-DMYSQL_CLIENT_NO_THREADS
diff -ur mysql/unittest/mysys/Makefile.am mysql-new//unittest/mysys/Makefile.am
--- mysql/unittest/mysys/Makefile.am	2010-01-15 16:17:56.000000000 -0100
+++ mysql-new//unittest/mysys/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -17,9 +17,9 @@
 AM_CPPFLAGS     += -I$(top_srcdir)/include -I$(top_srcdir)/unittest/mytap
 
 LDADD 		= $(top_builddir)/unittest/mytap/libmytap.a \
-		  $(top_builddir)/mysys/libmysys.a \
-		  $(top_builddir)/dbug/libdbug.a \
-		  $(top_builddir)/strings/libmystrings.a
+		  $(top_builddir)/mysys/libmysys.la \
+		  $(top_builddir)/dbug/libdbug.la \
+		  $(top_builddir)/strings/libmystrings.la
 
 noinst_PROGRAMS  = bitmap-t base64-t
 
diff -ur mysql/vio/Makefile.am mysql-new//vio/Makefile.am
--- mysql/vio/Makefile.am	2010-01-15 16:17:56.000000000 -0100
+++ mysql-new//vio/Makefile.am	2010-03-12 01:46:13.000000000 -0100
@@ -16,11 +16,12 @@
 INCLUDES =		-I$(top_builddir)/include -I$(top_srcdir)/include \
 			$(openssl_includes)
 LDADD =			@CLIENT_EXTRA_LDFLAGS@ $(openssl_libs) $(yassl_libs)
-pkglib_LIBRARIES =	libvio.a
+pkglib_LTLIBRARIES =	libvio.la
 
 noinst_HEADERS =	vio_priv.h
 
-libvio_a_SOURCES =	vio.c viosocket.c viossl.c viosslfactories.c
+libvio_la_LIBADD = -lssl
+libvio_la_SOURCES =	vio.c viosocket.c viossl.c viosslfactories.c
 
 EXTRA_DIST=		CMakeLists.txt
 
